import qualified all from ICAT
import all from ICAT
export qualified all from ICAT
export all from ICAT
export D_LOCAL_ZONE
export D_ZONE_ID
export D_NUM_DATA_BY_RESC
export D_NUM_DATA_BY_NAME
export D_TOKEN_ID
export D_TOKEN_NAME_BY_NAMESPACE_AND_NAME
export D_USER
export D_METAMAP_BY_OBJ_ID
export D_ACCESS_BY_OBJ_ID_AND_USER
export D_ACCESS_BY_ACCESS_TYPE_TOKEN
export D_METAMAP_BY_NAME
export D_METAMAP
export D_META_MAP_BY_OBJ_ID
export D_RESC_GROUP_ID
export D_META_VALUE_AND_UNITS_TS
export D_AVUS
export D_RESC_PARENT_BY_ZONE_AND_NAME
export D_RESC_TYPE_NAME_BY_ZONE_AND_NAME
export D_RESC_PARENT_TS
export D_COLL_CHILD_BY_NAME
export D_COLL_BY_NAME
export D_ACCESS_BY_OBJ_ID
export D_ACCESS_BY_COLL_NAME
export D_PASSWORD_BY_USER_ZONE_AND_NAME
export D_USER_PASSWORD_BY_USER_ZONE_AND_NAME
export D_USER_PASSWORD_BY_USER_ZONE_AND_NAME
export D_USER_PASSWORD_BY_USER
export D_USER_PASSWORD_BY_USER_ZONE_AND_NAME_AND_CREATE_TS
export D_USER_PASSWORD_BY_USER_AND_EXPIRY_TS
export D_USER_PASSWORD_BY_USER_ZONE_AND_NAME_AND_EXPIRY_TS
export D_USER_PASSWORD_BY_USER
export D_USER_PASSWORD_BY_EXPIRY_TS_AND_MODIFY_TS
export D_DATA_ACCESS_BY_USER_RECURSIVE
export D_COLL_ACCESS_BY_USER_RECURSIVE
export D_DATA_ACCESS_RECURSIVE
export D_COLL_ACCESS_RECURSIVE
export D_COLL_ID_IF_OWN_ACCESS_BY_USER_ZONE_AND_NAME
export D_COLL_IF_MODIFY_OBJECT_ACCESS_BY_USER_ZONE_AND_NAME
export D_COLL_IF_OWN_ACCESS_BY_USER_ZONE_AND_NAME
export D_SUB_COLL_ID_BY_NAME
export D_USER_PASSWORD_BY_PASSWORD
export D_USER_PASSWORD_BY_EXPIRY_TS_AND_CREATE_TS
export D_USER_GROUP
export D_USER_GROUP
export D_USER_AUTH
export D_RESC_ID
export D_RESC_ID_BY_DATA_ID
export D_RESC_ID_BY_NAME
export D_RESC_BY_NAME
export D_USER_ID
export D_USER_ID_WITH_PASSWORD
export D_META_ID
export D_META_ID_BY_ATTRIBUTE_AND_VALUE
export D_META_ID_BY_ATTRIBUTE_AND_OBJ_ID
export D_METAMAP_BY_ATTRIBUTE_AND_OBJ_ID
export D_METAMAP_ALLOW_NULL_UNITS_USE_WILDCARDS
export D_METAMAP_ALLOW_NULL_UNITS
export D_METAMAP_USE_WILDCARDS
export D_METAMAP_BY_AVU_AND_OBJ_ID
export D_META
export D_COLL_INHERITANCE_TS
export D_COLL_MODIFY_TS
export D_COLL_NAME_TS
export D_COLL_ID_BY_DATA
export D_COLL_ID_BY_COLL
export D_COLL_ID_BY_COLL_ID
export D_COLL_ID_BY_NAME
export D_COLL_INHERITANCE_BY_NAME
export D_NON_GROUP_USER_ID
export D_USER_BY_ZONE_AND_NAME
export D_GROUP_ID
export D_USER_TYPE_BY_ZONE_AND_NAME
export D_PASSWORD_BY_USER_ZONE_AND_NAME_AND_DIFF_EXPIRY_TS
export D_USER_PASSWORD
export D_PASSWORD_EXPIRY_TS
export D_DATA_ID
export D_REPL_RESC_ID
export D_REPL2
export D_REPL
export D_ACCESS_INHERIT_COLL
export D_ACCESS_BY_USER_ZONE_AND_NAME
export D_ACCESS_RECURSIVE
export D_MAX_REPL_NUM
export D_DIFF_REPL_NUM
export D_REPL_BY_NAME
export D_DATA_BY_NAME
export D_RESC_PARENT
export D_RESC_CHILD
export D_RULE_EXEC
export D_RESC
export D_COLL
export D_ZONE
export D_ZONE_COMMENT_TS
export D_RESC_COMMENT_TS
export D_RESC_INFO_TS
export D_ZONE_CONN_STRING_TS
export D_ZONE_NAME_TS
export D_COLL_OWNER_ZONE_BY_ZONE_NAME
export D_DATA_OWNER_ZONE_BY_ZONE_NAME
export D_RESC_ZONE_BY_ZONE_NAME
export D_RESC_FREE_SPACE_BY_NAME
export D_RESC_FREE_SPACE_TS
export D_RESC_NET_TS
export D_RESC_TYPE_NAME_TS
export D_RESC_DEF_PATH
export D_RESC_DEF_PATH_TS
export D_RESC_STATUS_TS
export D_RESC_NAME_TS
export D_SERVER_LOAD_RESC_NAME_BY_RESC_NAME
export D_SERVER_LOAD_DIGEST_RESC_NAME_BY_RESC_NAME
export D_RESC_CONTEXT_TS
export D_RULE_OWNER_ZONE_BY_ZONE_NAME
export D_USER_ZONE_BY_ZONE_NAME
export D_ZONE_NAME_BY_ZONE_NAME
export D_ZONE_TYPE_BY_NAME
export D_ZONE_BY_NAME
export D_NUM_PASSWORD_BY_USER_NAME
export D_DATA_NAME
export D_DATA_NAME_BY_ID_AND_ACCESS
export D_COLL_NAME
export D_DATA_COLL_ID_TS
export D_TOKEN
export D_TOKEN_BY_NAMESPACE_AND_NAME
export D_SERVER_LOAD
export D_SERVER_LOAD_BY_CREATE_TS
export D_SERVER_LOAD_DIGEST
export D_SERVER_LOAD_DIGEST_BY_CREATE_TS
export D_QUOTA_USAGE_BY_MODIFY_TS
export D_QUOTA_USAGE
export D_QUOTA_BY_USER_ID_AND_RESC_ID
export D_QUOTA
export D_QUOTA_BY_USER_NAME_AND_RESC_NAME
export D_NUM_DATA_BY_RESC_RECURSIVE
export D_DATA_BY_RESC_NOT_IN_CHILD
export D_DATA_BY_RESC_LIST
export D_NEXT_ID
export D_USER_TYPE_BY_NAME_AND_USER_TYPE_TOKEN
export D_USER_ZONE_NAME_BY_ZONE_AND_NAME
export D_USER_AUTH_BY_USER_ZONE_AND_NAME
export D_USER_AUTH_BY_USER_NAME
export D_USER_INFO_BY_ZONE_AND_NAME
export D_USER_COMMENT_BY_ZONE_AND_NAME
export D_RESC_ID_BY_ACCESS
export D_COLL_ID_BY_COLL_ID_AND_ACCESS
export D_COLL_ID_BY_OWN
export D_COLL_ID_BY_ACCESS
export D_COLL_ID_AND_INHERITANCE_BY_ACCESS
export D_DATA_ID_BY_ACCESS
export D_DATA_ID_BY_OWN
export D_GROUP_ID_BY_USER
export D_DATA_ID_BY_DATA_ID_AND_ACCESS
export D_GROUP_ADMIN_USER_ID
export D_GROUP_MEMBER_COUNT
export D_ACCESS_PERMISSION_USE_WILDCARD
export D_DATA_PATH_BY_USER_ZONE_AND_NAME_AND_RESC_NAME
export D_DATA_PATH
export D_COLL_NAME_RECURSIVE
export D_DATA_RESC_HIER_RECURSIVE
export D_DATA_RESC_HIER
export D_COLL_PARENT_COLL_NAME_RECURSIVE

predicate D_LOCAL_ZONE property (property Text)
rewrite D_LOCAL_ZONE(zn)
    ZONE_NAME(zid, zn) ZONE_TYPE_NAME(zid, "local")

predicate D_ZONE_ID property (key Text, property Text)
rewrite D_ZONE_ID(zn, zid)
    ZONE_NAME(zid, zn)

predicate D_NUM_DATA_BY_RESC property (key Text, property Int)
rewrite D_NUM_DATA_BY_RESC(rid, c)
    let c = count distinct id (DATA_OBJ(id, rid))

predicate D_NUM_DATA_BY_NAME property (key Text, key Text, property Int)
rewrite D_NUM_DATA_BY_NAME(cn, n, c)
    let c = count distinct id (COLL_NAME(cid, cn) DATA_NAME(id, rid, n) DATA_COLL_ID(id, rid, cid))

predicate D_TOKEN_ID property(key Text, key Text, property Text)
rewrite D_TOKEN_ID (ns, n, id)
    TOKEN_NAME(id, n) TOKEN_NAMESPACE(id, ns)

predicate D_TOKEN_NAME_BY_NAMESPACE_AND_NAME property(key Text, key Text)
rewrite D_TOKEN_NAME_BY_NAMESPACE_AND_NAME (ns, n)
    TOKEN_NAME(id, n) TOKEN_NAMESPACE(id, ns)

predicate D_USER object(key Text, property Text, property Text, property Text, property Text, property Text)
rewrite insert D_USER(uid, un, type, zn, cts, mts)
    insert USER_OBJ(uid) USER_NAME(uid, un) USER_TYPE(uid, type) USER_ZONE_NAME(uid, zn) USER_CREATE_TS(uid, cts) USER_MODIFY_TS(uid, mts)

predicate D_METAMAP_BY_OBJ_ID object (key Text)
rewrite delete D_METAMAP_BY_OBJ_ID(id)
    OBJT_METAMAP_OBJ(id, mid) delete OBJT_METAMAP_OBJ(id, mid)

predicate D_ACCESS_BY_OBJ_ID_AND_USER object (key Text, key Text)
rewrite delete D_ACCESS_BY_OBJ_ID_AND_USER(id, uid)
    OBJT_ACCESS_OBJ(id, uid, acc) delete OBJT_METAMAP_OBJ(id, uid, acc)

predicate D_ACCESS_BY_ACCESS_TYPE_TOKEN object (key Text, key Text, key Text, property Text, property Text)
rewrite insert D_ACCESS_BY_ACCESS_TYPE_TOKEN(id, uid, acctoken, cts, mts)
    D_TOKEN_ID("access_type", acctoken, acc) insert OBJT_ACCESS_OBJ(id, uid, acc) OBJT_ACCESS_CRAETE_TS(id, uid, acc, cts) OBJT_ACCESS_MODIFY_TS(id, uid, acc, mts)

predicate D_METAMAP_BY_NAME object (key Text, key Text, key Text, property Text, property Text)
rewrite insert D_METAMAP_BY_NAME(cn, n, mid, cts, mts)
    DATA_NAME(id, n2) like(n2, n) DATA_COLL_ID(id, cid) COLL_NAME(cid, cn2) like(cn2, cn) insert OBJT_METAMAP_OBJ(id, mid) OBJT_METAMAP_CREATE_TS(id,mid, cts) OBJT_METAMAP_MODIFY_TS(id,mid,mts)

predicate D_METAMAP object (key Text, key Text, property Text, property Text)
rewrite insert D_METAMAP(id, mid, cts, mts)
    insert OBJT_METAMAP_OBJ(id, mid) OBJT_METAMAP_CREATE_TS(id,mid, cts) OBJT_METAMAP_MODIFY_TS(id,mid,mts)

predicate D_META_MAP_BY_OBJ_ID object (key Text, key Text, property Text, property Text)
rewrite insert D_META_MAP_BY_OBJ_ID(id, id2, cts, mts)
    OBJT_METAMAP_OBJ(id2, mid) insert OBJT_METAMAP_OBJ(id, mid) OBJT_METAMAP_CREATE_TS(id, mid, cts) OBJT_METAMAP_MODIFY_TS(id, mid, mts)

predicate D_RESC_GROUP_ID property (key Text, property Text)
rewrite D_RESC_GROUP_ID(rgn, rgid)
    RESC_GROUP_NAME(rgn, rgid)

predicate D_META_VALUE_AND_UNITS_TS object (key Text, property Text, property Text, property Text)
rewrite insert D_META_VALUE_AND_UNITS_TS(mid, v, u, mts)
    insert META_VALUE(mid, v) META_UNITS(mid, v) META_MODIFY_TS(mid, mts)

predicate D_AVUS object ()
rewrite delete D_AVUS()
    META_OBJ(mid) ~ OBJT_METAMAP_OBJ(id, mid) delete META_OBJ(mid)

predicate D_RESC_PARENT_BY_ZONE_AND_NAME property (key Text, key Text, property Text)
rewrite D_RESC_PARENT_BY_ZONE_AND_NAME(zn, rn, p)
    RESC_NAME(rid, rn) RESC_ZONE_NAME(rid, zn) RESC_PARENT(rid, p)

    predicate D_RESC_TYPE_NAME_BY_ZONE_AND_NAME property (key Text, key Text, property Text)
    rewrite D_RESC_TYPE_NAME_BY_ZONE_AND_NAME(zn, rn, p)
        RESC_NAME(rid, rn) RESC_ZONE_NAME(rid, zn) RESC_TYPE_NAME(rid, p)

predicate D_RESC_PARENT_TS property (key Text, property Text, property Text, property Text)
rewrite insert D_RESC_PARENT_TS(rid, p, pc, ts)
    insert RESC_PARENT(rid, p) RESC_PARENT_CONTEXT(rid, pc) RESC_MODIFY_TS(rid, ts)

predicate D_COLL_CHILD_BY_NAME property (key Text, property Text)
rewrite D_COLL_CHILD_BY_NAME(cn, id)
    distinct (COLL_PARENT_COLL_NAME(id, cn) | COLL_NAME(cid, cn) DATA_COLL_ID(id, rid, cid))

predicate D_COLL_BY_NAME object (key Text)
rewrite delete D_COLL_BY_NAME(cn)
    COLL_NAME(cid, cn) delete COLL_OBJ(cid)

predicate D_ACCESS_BY_OBJ_ID object (property Text)
rewrite delete D_ACCESS_BY_OBJ_ID(id)
    OBJT_ACCESS_OBJ(id, uid, acc) delete OBJT_ACCESS_OBJ(id, uid, acc)

predicate D_ACCESS_BY_COLL_NAME object (property Text)
rewrite delete D_ACCESS_BY_COLL_NAME(cn)
    COLL_NAME(cid, cn) OBJT_ACCESS_OBJ(cid, uid, acc) delete OBJT_ACCESS_OBJ(id, uid, acc)

predicate D_PASSWORD_BY_USER_ZONE_AND_NAME property (key Text, key Text, property Text)
rewrite D_PASSWORD_BY_USER_ZONE_AND_NAME(zn, un, pw)
    D_USER_ID(zn, un, uid) USER_PASSWORD_OBJ(uid, pw)

predicate D_USER_PASSWORD_BY_USER_ZONE_AND_NAME property (key Text, key Text, property Text, property Text, property Text, property Text)
rewrite D_USER_PASSWORD_BY_USER_ZONE_AND_NAME(zn, un, pw, expiryts, cts, mts)
    D_USER_ID(zn, un, uid) USER_PASSWORD_PASS_EXPIRY_TS(uid, pw, expiryts) USER_PASSWORD_CREATE_TS(uid, pw, cts) USER_PASSWORD_MODIFY_TS(uid, pw, mts)

// predicate D_USER_PASSWORD_BY_USER_ZONE_AND_NAME object (key Text, key Text, key Text, property Text, property Text, property Text)
// rewrite insert D_USER_PASSWORD_BY_USER_ZONE_AND_NAME(zn, un, pw, expiryts, cts, mts)
//     D_USER_ID(zn, un, uid) insert USER_PASSWORD_OBJ(uid, pw) USER_PASSWORD_PASS_EXPIRY_TS(uid, pw, expiryts) USER_PASSWORD_CREATE_TS(uid, pw, cts) USER_PASSWORD_MODIFY_TS(uid, pw, mts)

rewrite insert D_USER_PASSWORD_BY_USER_ZONE_AND_NAME(zn, un, pw, expiryts, cts, mts)
    D_USER_ID(zn, un, uid) insert USER_PASSWORD_OBJ(uid) USER_PASSWORD_RCAT_PASSWORD(uid, pw) USER_PASSWORD_PASS_EXPIRY_TS(uid, expiryts) USER_PASSWORD_CREATE_TS(uid, cts) USER_PASSWORD_MODIFY_TS(uid, mts)


predicate D_USER_PASSWORD_BY_USER property (key Text, property Text, property Text)
rewrite insert D_USER_PASSWORD_BY_USER(uid, pw, mts)
    USER_PASSWORD_OBJ(uid) insert USER_PASSWORD_RCAT_PASSWORD(uid, pw) USER_PASSWORD_MODIFY_TS(uid, mts)


predicate D_USER_PASSWORD_BY_USER_ZONE_AND_NAME_AND_CREATE_TS object (key Text, key Text, key Text, key Text)
rewrite delete D_USER_PASSWORD_BY_USER_ZONE_AND_NAME_AND_CREATE_TS(zn, un, pw, cts)
    D_USER_ID(zn, un, uid) USER_PASSWORD_CREATE_TS(uid, pw, cts) delete USER_PASSWORD_OBJ(uid, pw)

predicate D_USER_PASSWORD_BY_USER_AND_EXPIRY_TS object (key Text, key Int, key Int)
rewrite D_USER_PASSWORD_BY_USER_AND_EXPIRY_TS(uid, minx, maxx)
    USER_PASSWORD_PASS_EXPIRY_TS(uid, pw, expiryts) ~like(expiryts, "9999%") cast_int(expiryts, pw, x) le(minx, x) le(x, maxx)

predicate D_USER_PASSWORD_BY_USER_ZONE_AND_NAME_AND_EXPIRY_TS object (key Text, key Text, key Text, key Text)
rewrite delete D_USER_PASSWORD_BY_USER_ZONE_AND_NAME_AND_EXPIRY_TS(zn, un, minx, maxx)
    D_USER_ID(zn, un, uid) USER_PASSWORD_PASS_EXPIRY_TS(uid, pw, expiryts) ~like(expiryts, "9999%") cast_int(expiryts, pw, x) le(minx, x) le(x, maxx) delete USER_PASSWORD_OBJ(uid, pw)

predicate D_USER_PASSWORD_BY_USER object (key Text)
rewrite delete D_USER_PASSWORD_BY_USER(uid)
    USER_PASSWORD_OBJ(uid, pw) delete USER_PASSWORD_OBJ(uid, pw)

predicate D_USER_PASSWORD_BY_EXPIRY_TS_AND_MODIFY_TS object (key Text, key Text, key Text)
rewrite delete D_USER_PASSWORD_BY_EXPIRY_TS_AND_MODIFY_TS (minx, maxx, curr)
    USER_PASSWORD_PASS_EXPIRY_TS(uid, expiryts) ~like(expiryts, "9999%") cast_int(expiryts, x) le(minx, x) le(x, maxx) USER_PASSWORD_MODIFY_TS(uid, mts) cast_int(mts, y) add(x, y, z) lt(z, curr) delete USER_PASSWORD_OBJ(uid)

predicate D_DATA_ACCESS_BY_USER_RECURSIVE object (key Text, key Text)
rewrite delete D_DATA_ACCESS_BY_USER_RECURSIVE (uid, cn)
    concat(cn, "/%", pattern) COLL_NAME(cid, cn2) (eq(cn2, cn) | like (cn2, pattern)) DATA_COLL_ID(id, cid) OBJT_ACCESS_OBJ(uid, id, tid) delete OBJT_ACCESS_OBJ(uid, id, tid)

predicate D_COLL_ACCESS_BY_USER_RECURSIVE object (key Text, key Text)
rewrite delete D_COLL_ACCESS_BY_USER_RECURSIVE (uid, cn)
    concat(cn, "/%", pattern) COLL_NAME(cid, cn2) (eq(cn2, cn) | like (cn2, pattern)) OBJT_ACCESS_OBJ(uid, cid, tid) delete OBJT_ACCESS_OBJ(uid, cid, tid)

predicate D_DATA_ACCESS_RECURSIVE object (key Text, key Text, key Text, key Text, key Text)
rewrite insert D_DATA_ACCESS_BY_USER_RECURSIVE (uid, cn, acc, cts, mts)
    concat(cn, "/%", pattern) COLL_NAME(cid, cn2) (eq(cn2, cn) | like (cn2, pattern)) DATA_COLL_ID(id, cid)
    D_TOKEN_ID("access_type", acc, tid)
    insert OBJT_ACCESS_OBJ(uid, id, tid) OBJT_ACCESS_CRAETE_TS(uid, id, tid, cts) OBJT_ACCESS_MODIFY_TS(uid, id, tid, mts)

predicate D_COLL_ACCESS_RECURSIVE object (key Text, key Text, key Text, key Text, key Text)
rewrite insert D_COLL_ACCESS_BY_USER_RECURSIVE (uid, cn, acc, cts, mts)
    concat(cn, "/%", pattern) COLL_NAME(cid, cn2) (eq(cn2, cn) | like (cn2, pattern))
    D_TOKEN_ID("access_type", acc, tid)
    insert OBJT_ACCESS_OBJ(uid, cid, tid) OBJT_ACCESS_CRAETE_TS(uid, id, tid, cts) OBJT_ACCESS_MODIFY_TS(uid, id, tid, mts)


predicate D_COLL_ID_IF_OWN_ACCESS_BY_USER_ZONE_AND_NAME object (key Text, key Text, key Text, property Text)
rewrite D_COLL_ID_IF_OWN_ACCESS_BY_USER_ZONE_AND_NAME(uz, un, id, cid)
    D_TOKEN_ID("access_type", "own", tid) D_NON_GROUP_USER_ID(uz, un, uid) OBJT_ACCESS_OBJ(uid, id, tid) DATA_COLL_ID(id, cid)

predicate D_COLL_IF_MODIFY_OBJECT_ACCESS_BY_USER_ZONE_AND_NAME object (key Text, key Text, key Text, property Text, property Text)
rewrite D_COLL_IF_MODIFY_OBJECT_ACCESS_BY_USER_ZONE_AND_NAME(uz, un, id, cn, pcn)
    D_TOKEN_ID("access_type", "modify object", tid) D_NON_GROUP_USER_ID(uz, un, uid) OBJT_ACCESS_OBJ(uid, id, tid) COLL_NAME(id, cn) COLL_PARENT_COLL_NAME(id, pcn)

predicate D_COLL_IF_OWN_ACCESS_BY_USER_ZONE_AND_NAME object (key Text, key Text, key Text, property Text, property Text)
rewrite D_COLL_IF_OWN_ACCESS_BY_USER_ZONE_AND_NAME(uz, un, id, cn, pcn)
    D_TOKEN_ID("access_type", "own", tid) D_NON_GROUP_USER_ID(uz, un, uid) OBJT_ACCESS_OBJ(uid, id, tid) COLL_NAME(id, cn) COLL_PARENT_COLL_NAME(id, pcn)

predicate D_SUB_COLL_ID_BY_NAME object (key Text, key Text, property Text)
rewrite D_SUB_COLL_ID_BY_NAME(cid, scn, scid)
    COLL_NAME(cid, cn) concat (cn, "/", cn2) concat(cn2, scn, scn2) COLL_NAME(scid, scn2)


predicate D_USER_PASSWORD_BY_PASSWORD object (key Text)
rewrite delete D_USER_PASSWORD_BY_PASSWORD(pw)
    USER_PASSWORD_OBJ(uid, pw) delete USER_PASSWORD_OBJ(uid, pw)

predicate D_USER_PASSWORD_BY_EXPIRY_TS_AND_CREATE_TS object (key Text, key Text)
rewrite delete D_USER_PASSWORD_BY_EXPIRY_TS_AND_CREATE_TS(expiryts, cts)
    USER_PASSWORD_PASS_EXPIRY_TS(uid, pw, expiryts) USER_PASSWORD_CREATE_TS(uid, pw, cts2) lt(cts2, cts) delete USER_PASSWORD_OBJ(uid, pw)

predicate D_USER_GROUP object (key Text, key Text)
rewrite delete D_USER_GROUP(gid, uid)
    delete USER_GROUP_OBJ(gid, uid)

predicate D_USER_GROUP object (key Text, key Text, property Text, property Text)
rewrite insert D_USER_GROUP(gid, uid, cts, mts)
    insert USER_GROUP_OBJ(gid, uid) USER_GROUP_CREATE_TS(gid, uid, cts) USER_GROUP_MODIFY_TS(gid,uid, mts)

predicate D_USER_AUTH object (key Text)
rewrite delete D_USER_AUTH(uid)
    delete USER_AUTH_OBJ(uid)

predicate D_RESC_ID property (key Text, key Text, property Text)
rewrite D_RESC_ID (zn, rn, rid)
    RESC_NAME(rid, rn) RESC_ZONE_NAME(rid, zn)

predicate D_RESC_ID_BY_DATA_ID property (key Text, property Text)
rewrite D_RESC_ID_BY_DATA_ID (id, rid)
    DATA_RESC_ID(id, rid)

predicate D_RESC_ID_BY_NAME property (key Text, property Text)
rewrite D_RESC_ID_BY_NAME (rn, rid)
    RESC_NAME(rid, rn)

predicate D_RESC_BY_NAME property (key Text)
rewrite delete D_RESC_BY_NAME (rn)
    RESC_NAME(rid, rn) delete RESC_OBJ(rid)

predicate D_USER_ID property (key Text, key Text, property Text)
rewrite D_USER_ID(zn, un, uid)
    USER_NAME(uid, un) USER_ZONE_NAME(uid, zn)

predicate D_USER_ID_WITH_PASSWORD property (key Text, key Text, property Text)
rewrite D_USER_ID_WITH_PASSWORD(zn, un, uid)
    USER_NAME(uid, un) USER_ZONE_NAME(uid, zn) USER_PASSWORD_OBJ(uid, pw)

predicate D_META_ID property (key Text, key Text, key Text, property Text)
rewrite D_META_ID(a, v, u, mid)
    META_ATTRIBUTE(mid, a) META_VALUE(mid, v) META_UNITS(mid, u)

predicate D_META_ID_BY_ATTRIBUTE_AND_VALUE property (key Text, key Text, property Text)
rewrite D_META_ID_BY_ATTRIBUTE_AND_VALUE(a, v, mid)
    META_ATTRIBUTE(mid, a) META_VALUE(mid, v) (META_UNITS(mid, u) | META_UNITS(mid, ""))

predicate D_META_ID_BY_ATTRIBUTE_AND_OBJ_ID property (key Text, key Text, property Text)
rewrite D_META_ID_BY_ATTRIBUTE_AND_OBJ_ID(a, id, mid)
    META_ATTRIBUTE(mid, a) OBJT_METAMAP_OBJ(id, mid)

predicate D_METAMAP_BY_ATTRIBUTE_AND_OBJ_ID property (key Text, key Text)
rewrite delete D_METAMAP_BY_ATTRIBUTE_AND_OBJ_ID(a, id)
    META_ATTRIBUTE(mid, a) OBJT_METAMAP_OBJ(id, mid) delete OBJT_METAMAP_OBJ(id, mid)

predicate D_METAMAP_ALLOW_NULL_UNITS_USE_WILDCARDS property (key Text, key Text, key Text, key Text)
rewrite delete D_METAMAP_ALLOW_NULL_UNITS_USE_WILDCARDS(a, v, u, id)
    D_META_ID(a2, v2, u2, mid) like(a2, a) like(v2, v) (like(u2, u)|eq(u2,"")) OBJT_METAMAP_OBJ(id, mid) delete OBJT_METAMAP_OBJ(id, mid)

predicate D_METAMAP_ALLOW_NULL_UNITS property (key Text, key Text, key Text, key Text)
rewrite delete D_METAMAP_ALLOW_NULL_UNITS(a, v, u, id)
    D_META_ID(a2, v2, u2, mid) eq(a2, a) eq(v2, v) (eq(u2, u)|eq(u2,"")) OBJT_METAMAP_OBJ(id, mid) delete OBJT_METAMAP_OBJ(id, mid)

predicate D_METAMAP_USE_WILDCARDS property (key Text, key Text, key Text, key Text)
rewrite delete D_METAMAP_USE_WILDCARDS(a, v, u, id)
    D_META_ID(a2, v2, u2, mid) like(a2, a) like(v2, v) like(u2, u) OBJT_METAMAP_OBJ(id, mid) delete OBJT_METAMAP_OBJ(id, mid)

predicate D_METAMAP_BY_AVU_AND_OBJ_ID property (key Text, key Text, key Text, key Text)
rewrite delete D_METAMAP_BY_AVU_AND_OBJ_ID(a, v, u, id)
    D_META_ID(a2, v2, u2, mid) eq(a2, a) eq(v2, v) eq(u2, u) OBJT_METAMAP_OBJ(id, mid) delete OBJT_METAMAP_OBJ(id, mid)

predicate D_META object (key Text, property Text, property Text, property Text, property Text, property Text)
rewrite insert D_META(mid, a, v, u, cts, mts)
    insert META_OBJ(mid) META_ATTRIBUTE(mid, a) META_VALUE(mid, v) META_UNITS(mid, u) META_CREATE_TS(mid, cts) META_MODIFY_TS(mid, mts)

predicate D_COLL_INHERITANCE_TS property (key Text, property Text, property Text)
rewrite insert D_COLL_INHERITANCE_TS(cid, ci, ts)
    insert COLL_INHERITANCE(cid, ci) COLL_MODIFY_TS(cid, ts)

predicate D_COLL_MODIFY_TS property (key Text, property Text)
rewrite insert D_COLL_MODIFY_TS(cid, ci)
    insert COLL_MODIFY_TS(cid, ts)

predicate D_COLL_NAME_TS property (key Text, property Text, property Text)
rewrite insert D_COLL_NAME_TS(cid, cn, ci)
    insert COLL_NAME(cid, cn) COLL_MODIFY_TS(cid, ts)

predicate D_COLL_ID_BY_DATA property (key Text, property Text)
rewrite D_COLL_ID_BY_DATA(id, cid)
    DATA_COLL_ID(id, cid)

predicate D_COLL_ID_BY_COLL property (key Text, property Text)
rewrite D_COLL_ID_BY_COLL(cid, cid2)
    COLL_OBJ(cid) eq(cid, cid2)

predicate D_COLL_ID_BY_COLL_ID property (key Text, property Text)
rewrite D_COLL_ID_BY_COLL_ID(cid,cid2)
    COLL_OBJ(cid) COLL_OBJ(cid2) eq(cid, cid2)

predicate D_COLL_ID_BY_NAME property (key Text, property Text)
rewrite D_COLL_ID_BY_NAME(cid, cn)
    COLL_NAME(cid, cn)

predicate D_COLL_INHERITANCE_BY_NAME property (property Text, property Text, property Text, property Text)
rewrite insert D_COLL_INHERITANCE_BY_NAME(cn, cs, ci, ts)
    (COLL_NAME(cid, cn) | COLL_NAME(cid, cn2) like(cn2, cs)) insert COLL_INHERITANCE_TS(cid, ci, ts)

predicate D_NON_GROUP_USER_ID property (key Text, key Text, property Text)
rewrite D_NON_GROUP_USER_ID(zn, un, uid)
    D_USER_ID(zn, un, uid) USER_TYPE(uid, ut) ~eq(ut, "rodsgroup")

predicate D_USER_BY_ZONE_AND_NAME property (key Text, key Text)
rewrite delete D_USER_BY_ZONE_AND_NAME(zn, un)
    D_USER_ID(zn, un, uid) delete USER_OBJ(uid)

predicate D_GROUP_ID property (key Text, key Text, property Text)
rewrite D_GROUP_ID(zn, un, uid)
    D_USER_ID(zn, un, uid) USER_TYPE(uid, "rodsgroup")

predicate D_USER_TYPE_BY_ZONE_AND_NAME property (key Text, key Text, property Text)
rewrite D_USER_TYPE_BY_ZONE_AND_NAME(zn, un, type)
    D_USER_ID(zn, un, uid) USER_TYPE(uid, type)

predicate D_PASSWORD_BY_USER_ZONE_AND_NAME_AND_DIFF_EXPIRY_TS property (key Text, key Text, key Text, property Text)
rewrite D_PASSWORD_BY_USER_ZONE_AND_NAME_AND_DIFF_EXPIRY_TS(zn, un, expiryts, pw)
    D_USER_ID(zn, un, uid) USER_PASSWORD_PASS_EXPIRY_TS(uid, pw, expiryts2) ~eq(expiryts2, expiryts)

predicate D_USER_PASSWORD object (key Text, key Text, property Text, property Text, property Text)
rewrite insert D_USER_PASSWORD(uid, pw, expiryts, cts, mts)
    insert USER_PASSWORD_OBJ(uid, pw) USER_PASSWORD_PASS_EXPIRY_TS(uid, pw, expiryts) USER_PASSWORD_CREATE_TS(uid, pw, cts) USER_PASSWORD_MODIFY_TS(uid, pw, mts)

predicate D_PASSWORD_EXPIRY_TS property (key Text, key Text, property Text, property Text)
rewrite insert D_PASSWORD_EXPIRY_TS(uid, pw, expiryts, mts)
    insert USER_PASSWORD_PASS_EXPIRY_TS(uid, pw, expiryts) USER_PASSWORD_MODIFY_TS(uid, pw, mts)

predicate D_DATA_ID property (key Text, key Text, property Text)
rewrite D_DATA_ID(cid, n, id)
    DATA_COLL_ID(id, rid, cid) DATA_NAME(id, rid, n)

predicate D_REPL_RESC_ID property (key Text, key Text, property Text)
rewrite D_REPL_RESC_ID (id, rnum, rid)
    DATA_REPL_NUM(id, rid, rnum)

predicate D_REPL2 property (key Text, key Text, property Text, property Text, property Text, property Text, property Text, property Text, property Text, property Text, property Text, property Text, property Text, property Text, property Text, property Text, property Text, property Text, property Text, property Text, property Text, property Text)
rewrite D_REPL2(id, rid, cid, n, rnum, version, dtype, dsize, filepath, un, zn, dirty, status, chksum, dmode, cts, mts, expts, rn)
    DATA_COLL_ID(id, rid, cid) DATA_NAME(id, rid, n) DATA_REPL_NUM(id, rid, rnum) DATA_VERSION(id, rid, version) DATA_TYPE(id, rid, dtype)
    DATA_SIZE(id, rid, dsize) DATA_FILE_PATH(id, rid, filepath) DATA_OWNER_NAME(id, rid, un) DATA_OWNER_ZONE(id, rid, zn)
    DATA_IS_DIRTY(id, rid, dirty) DATA_STATUS(id, rid, status) DATA_CHECKSUM(id, rid, chksum) DATA_MODE(id, rid, dmode) DATA_CREATE_TS(id, rid, cts) DATA_MODIFY_TS(id, rid, mts)
    DATA_EXPIRY_TS(id, rid, expts) DATA_RESC_NAME(id, rid, rn)

rewrite insert D_REPL2(id, rid, cid, n, rnum, version, dtype, dsize, filepath, un, zn, dirty, status, chksum, dmode, cts, mts, expts, rn)
    insert DATA_COLL_ID(id, rid, cid) DATA_NAME(id, rid, n) DATA_REPL_NUM(id, rid, rnum) DATA_VERSION(id, rid, version) DATA_TYPE(id, rid, dtype)
            DATA_SIZE(id, rid, dsize) DATA_FILE_PATH(id, rid, filepath) DATA_OWNER_NAME(id, rid, un) DATA_OWNER_ZONE(id, rid, zn)
            DATA_IS_DIRTY(id, rid, dirty) DATA_STATUS(id, rid, status) DATA_CHECKSUM(id, rid, chksum) DATA_MODE(id, rid, dmode) DATA_CREATE_TS(id, rid, cts) DATA_MODIFY_TS(id, rid, mts)
            DATA_EXPIRY_TS(id, rid, expts) DATA_RESC_NAME(id, rid, rn)

predicate D_REPL2_BY_REPL_NUM property (key Text, key Text, property Text, property Text, property Text, property Text, property Text, property Text, property Text, property Text, property Text, property Text, property Text, property Text, property Text, property Text, property Text, property Text, property Text, property Text, property Text, property Text)
rewrite D_REPL2_BY_REPL_NUM(id, rnum, rid, cid, n, version, dtype, dsize, filepath, un, zn, dirty, status, chksum, dmode, cts, mts, expts, rn)
    DATA_COLL_ID(id, rid, cid) DATA_NAME(id, rid, n) DATA_REPL_NUM(id, rid, rnum) DATA_VERSION(id, rid, version) DATA_TYPE(id, rid, dtype)
    DATA_SIZE(id, rid, dsize) DATA_FILE_PATH(id, rid, filepath) DATA_OWNER_NAME(id, rid, un) DATA_OWNER_ZONE(id, rid, zn)
    DATA_IS_DIRTY(id, rid, dirty) DATA_STATUS(id, rid, status) DATA_CHECKSUM(id, rid, chksum) DATA_MODE(id, rid, dmode) DATA_CREATE_TS(id, rid, cts) DATA_MODIFY_TS(id, rid, mts)
    DATA_EXPIRY_TS(id, rid, expts) DATA_RESC_NAME(id, rid, rn)

rewrite insert D_REPL2_BY_REPL_NUM(id, rnum, rid, cid, n, version, dtype, dsize, filepath, un, zn, dirty, status, chksum, dmode, cts, mts, expts, rn)
    insert DATA_COLL_ID(id, rid, cid) DATA_NAME(id, rid, n) DATA_REPL_NUM(id, rid, rnum) DATA_VERSION(id, rid, version) DATA_TYPE(id, rid, dtype)
            DATA_SIZE(id, rid, dsize) DATA_FILE_PATH(id, rid, filepath) DATA_OWNER_NAME(id, rid, un) DATA_OWNER_ZONE(id, rid, zn)
            DATA_IS_DIRTY(id, rid, dirty) DATA_STATUS(id, rid, status) DATA_CHECKSUM(id, rid, chksum) DATA_MODE(id, rid, dmode) DATA_CREATE_TS(id, rid, cts) DATA_MODIFY_TS(id, rid, mts)
            DATA_EXPIRY_TS(id, rid, expts) DATA_RESC_NAME(id, rid, rn)

predicate D_REPL object (key Text, key Text, property Text, property Text, property Text, property Text, property Text, property Text, property Text, property Text, property Text, property Text, property Text, property Text, property Text, property Text, property Text, property Text, property Text, property Text, property Text, property Text)
rewrite insert D_REPL(id, rid, cid, n, rnum, version, dtype, dsize, filepath, un, zn, dirty, status, chksum, dmode, cts, mts, expts, rn)
    insert DATA_OBJ(id, rid) DATA_COLL_ID(id, rid, cid) DATA_NAME(id, rid, n) DATA_REPL_NUM(id, rid, rnum) DATA_VERSION(id, rid, version) DATA_TYPE(id, rid, dtype)
            DATA_SIZE(id, rid, dsize) DATA_FILE_PATH(id, rid, filepath) DATA_OWNER_NAME(id, rid, un) DATA_OWNER_ZONE(id, rid, zn)
            DATA_IS_DIRTY(id, rid, dirty) DATA_STATUS(id, rid, status) DATA_CHECKSUM(id, rid, chksum) DATA_MODE(id, rid, dmode) DATA_CREATE_TS(id, rid, cts) DATA_MODIFY_TS(id, rid, mts)
            DATA_EXPIRY_TS(id, rid, expts) DATA_RESC_NAME(id, rid, rn)

predicate D_ACCESS_INHERIT_COLL object (property Text, property Text, property Text, property Text)
rewrite insert D_ACCESS_INHERIT_COLL(id, cid, cts, mts)
    OBJT_ACCESS_OBJ(cid, uid, acc) insert OBJT_ACCESS_OBJ(id, uid, acc) OBJT_ACCESS_CRAETE_TS(id, uid, acc, cts) OBJT_ACCESS_MODIFY_TS(id, uid, acc, mts)

predicate D_ACCESS_BY_USER_ZONE_AND_NAME object (key Text, key Text, key Text, key Text, property Text, property Text)
rewrite insert D_ACCESS_BY_USER_ZONE_AND_NAME(id, zn, un, acctoken, cts, mts)
    D_USER_ID(zn, un, uid) D_TOKEN_ID("access_type", acctoken, acc) insert OBJT_ACCESS_OBJ(id, uid, acc) OBJT_ACCESS_CRAETE_TS(id, uid, acc, cts) OBJT_ACCESS_MODIFY_TS(id, uid, acc, mts)

predicate D_ACCESS_RECURSIVE object (key Text, key Text, key Text, key Text, property Text, property Text)
rewrite insert D_ACCESS_RECURSIVE(id, uid, acctoken, cts, mts, cn, cnpat)
    D_TOKEN_ID("access_type", acctoken, acc) distinct ((COLL_NAME(id, cn) | COLL_NAME(id, cn2) like(cn2, cnpat)) return id) insert OBJT_ACCESS_OBJ(id, uid, acc) OBJT_ACCESS_CRAETE_TS(id, uid, acc, cts) OBJT_ACCESS_MODIFY_TS(id, uid, acc, mts)

predicate D_MAX_REPL_NUM property (key Text, property Text)
rewrite D_MAX_REPL_NUM(id, c)
    let c = max rnum (DATA_REPL_NUM(id, rid, rnum))

predicate D_DIFF_REPL_NUM property (key Text, key Text, property Text)
rewrite D_DIFF_REPL_NUM(id, rnum, rnum2)
    DATA_REPL_NUM(id, rid, rnum2) ~eq(rnum2, rnum)

predicate D_REPL_BY_NAME object (key Text, key Text, key Text)
rewrite delete D_REPL_BY_NAME(cn, n, rnum)
    COLL_NAME(cid, cn) DATA_NAME(id, rid, n) DATA_COLL_ID(id, rid, cid) DATA_REPL_NUM(id, rid, rnum) delete DATA_OBJ(id, rid)

predicate D_DATA_BY_NAME object (key Text, key Text)
rewrite delete D_DATA_BY_NAME(cn, n)
    COLL_NAME(cid, cn) DATA_NAME(id, rid, n) DATA_COLL_ID(id, rid, cid) delete DATA_OBJ(id, rid)

predicate D_RESC_PARENT property (key Text, property Text)
rewrite D_RESC_PARENT(rid, p)
    RESC_PARENT(rid, p)

predicate D_RESC_CHILD property (key Text, property Text)
rewrite D_RESC_CHILD(rid, ch)
    RESC_PARENT(ch, rid)

predicate D_RULE_EXEC property (key Text)
rewrite delete D_RULE_EXEC(ruleid)
    delete RULE_EXEC_OBJ(ruleid)

predicate D_RESC object (key Text, property Text, property Text, property Text, property Text, property Text, property Text, property Text, property Text, property Text, property Text, property Text)
rewrite insert D_RESC(rid, rn, zn, type, class, net, defpath, cts, mts, children, context, parent)
    insert RESC_OBJ(rid) RESC_NAME(rid, rn) RESC_ZONE_NAME(rid, zn) RESC_TYPE_NAME(rid, type) RESC_CLASS_NAME(rid, class) RESC_NET(rid, net) RESC_DEF_PATH(rid, defpath) RESC_CREATE_TS(rid, cts) RESC_MODIFY_TS(rid, mts) RESC_CHILDREN(rid, children) RESC_CONTEXT(rid, context) RESC_PARENT(rid, parent)

predicate D_COLL object (key Text, property Text, property Text, property Text, property Text, property Text, property Text, property Text, property Text, property Text)
rewrite insert D_COLL(cid, pn, cn, owner, zn, type, info1, info2, cts, mts)
    insert COLL_OBJ(cid) COLL_NAME(cid, cn) COLL_OWNER_ZONE(cid, zn) COLL_TYPE(cid, type) COLL_OWNER_NAME(cid, owner) COLL_INFO1(cid, info1) COLL_INFO(cid, info2) COLL_CREATE_TS(cid, cts) COLL_MODIFY_TS(cid, mts) COLL_PARENT_COLL_NAME(cid, pn)

predicate D_ZONE object (key Text, property Text, property Text, property Text, property Text, property Text, property Text)
rewrite insert D_ZONE(zid, zn, type, conn, comm, cts, mts)
    insert ZONE_OBJ(zid) ZONE_NAME(zid, zn) ZONE_TYPE_NAME(zid, type) ZONE_CONN_STRING(zid, conn) ZONE_COMMENT(zid, comm) COLL_CREATE_TS(zid, cts) ZONE_MODIFY_TS(zid, mts)

predicate D_ZONE_COMMENT_TS object (key Text, property Text, property Text)
rewrite insert D_ZONE_COMMENT_TS(zid, comm, mts)
    insert ZONE_COMMENT(zid, comm) ZONE_MODIFY_TS(zid, mts)

predicate D_RESC_COMMENT_TS object (key Text, property Text, property Text)
rewrite insert D_RESC_COMMENT_TS(zid, comm, mts)
    insert RESC_COMMENT(zid, comm) RESC_MODIFY_TS(zid, mts)

predicate D_RESC_INFO_TS object (key Text, property Text, property Text)
rewrite insert D_RESC_INFO_TS(zid, comm, mts)
    insert RESC_INFO(zid, comm) RESC_MODIFY_TS(zid, mts)

predicate D_ZONE_CONN_STRING_TS object (key Text, property Text, property Text)
rewrite insert D_ZONE_CONN_STRING_TS(zid, conn, mts)
    insert ZONE_CONN_STRING(zid, conn) ZONE_MODIFY_TS(zid, mts)

predicate D_ZONE_NAME_TS object (key Text, property Text, property Text)
rewrite insert D_ZONE_NAME_TS(zid, zn, mts)
    insert ZONE_NAME(zid, zn) ZONE_MODIFY_TS(zid, mts)

predicate D_COLL_OWNER_ZONE_BY_ZONE_NAME object (key Text, property Text, property Text)
rewrite insert D_COLL_OWNER_ZONE_BY_ZONE_NAME(zn, zn2, mts)
    COLL_OWNER_ZONE(cid, zn) insert COLL_OWNER_ZONE(cid, zn2) COLL_MODIFY_TS(cid, mts)

predicate D_DATA_OWNER_ZONE_BY_ZONE_NAME object (key Text, property Text, property Text)
rewrite insert D_DATA_OWNER_ZONE_BY_ZONE_NAME(zn, zn2, mts)
    DATA_OWNER_ZONE(id, zn) insert DATA_OWNER_ZONE(id, zn2) DATA_MODIFY_TS(id, mts)

predicate D_RESC_ZONE_BY_ZONE_NAME object (key Text, property Text, property Text)
rewrite insert D_RESC_ZONE_BY_ZONE_NAME(zn, zn2, mts)
    RESC_ZONE(rid, zn) insert RESC_ZONE(rid, zn2) RESC_MODIFY_TS(rid, mts)

predicate D_RESC_FREE_SPACE_BY_NAME property (key Text, property Text, property Text)
rewrite insert D_RESC_FREE_SPACE_BY_NAME(rn, fs, mts)
    RESC_NAME(rid, rn) insert RESC_FREE_SPACE(rid, fs) RESC_MODIFY_TS(rid, mts)


predicate D_RESC_FREE_SPACE_TS property (key Text, property Text, property Text, property Text)
rewrite insert D_RESC_FREE_SPACE_TS(rid, fs, fsts, mts)
    insert RESC_FREE_SPACE(rid, fs) RESC_FREE_SPACE_TS(rid, fsts) RESC_MODIFY_TS(rid, mts)

predicate D_RESC_NET_TS property (key Text, property Text, property Text)
rewrite insert D_RESC_NET_TS(rid, fs, mts)
    insert RESC_NET(rid, fs) RESC_MODIFY_TS(rid, mts)

predicate D_RESC_TYPE_NAME_TS property (key Text, property Text, property Text)
rewrite insert D_RESC_TYPE_NAME_TS(rid, fs, mts)
    insert RESC_TYPE_NAME(rid, fs) RESC_MODIFY_TS(rid, mts)

predicate D_RESC_DEF_PATH property (key Text, property Text)
rewrite insert D_RESC_DEF_PATH(rid, fs)
    RESC_DEF_PATH(rid, fs)

rewrite D_RESC_DEF_PATH(rid, fs)
    RESC_DEF_PATH(rid, fs)

predicate D_RESC_DEF_PATH_TS property (key Text, property Text, property Text)
rewrite insert D_RESC_DEF_PATH_TS(rid, fs, mts)
    insert RESC_DEF_PATH(rid, fs) RESC_MODIFY_TS(rid, mts)

predicate D_RESC_STATUS_TS property (key Text, property Text, property Text)
rewrite insert D_RESC_STATUS_TS(rid, fs, mts)
    insert RESC_STATUS(rid, fs) RESC_MODIFY_TS(rid, mts)

predicate D_RESC_NAME_TS property (key Text, property Text, property Text)
rewrite insert D_RESC_NAME_TS(rid, fs, mts)
    insert RESC_NAME(rid, fs) RESC_MODIFY_TS(rid, mts)

predicate D_SERVER_LOAD_RESC_NAME_BY_RESC_NAME property (key Text, property Text)
rewrite insert D_SERVER_LOAD_RESC_NAME_BY_RESC_NAME(rn, rn2)
    SERVER_LOAD_OBJ(a, rn, b, c, e, d, f, g, h, i) delete SERVER_LOAD_OBJ(a, rn, b, c, e, d, f, g, h, i) insert SERVER_LOAD_OBJ(a, rn2, b, c, e, d, f, g, h, i)

predicate D_SERVER_LOAD_DIGEST_RESC_NAME_BY_RESC_NAME property (key Text, property Text)
rewrite insert D_SERVER_LOAD_DIGEST_RESC_NAME_BY_RESC_NAME(rn, rn2)
    SERVER_LOAD_DIGEST_OBJ(rn, lf, ts) delete SERVER_LOAD_DIGEST_OBJ(rn, lf, ts) insert SERVER_LOAD_DIGEST_OBJ(rn2, lf, ts)

predicate D_RESC_CONTEXT_TS property (key Text, property Text, property Text)
rewrite insert D_RESC_CONTEXT_TS(rid, rcontext, mts)
    insert RESC_CONTEXT(rid, rcontext) RESC_MODIFY_TS(rid, mts)

predicate D_RULE_OWNER_ZONE_BY_ZONE_NAME object (key Text, property Text, property Text)
rewrite insert D_RULE_OWNER_ZONE_BY_ZONE_NAME(zn, zn2, mts)
    RULE_OWNER_ZONE(id, zn) insert RULE_OWNER_ZONE(id, zn2) RULE_MODIFY_TS(id, mts)

predicate D_USER_ZONE_BY_ZONE_NAME object (key Text, property Text, property Text)
rewrite insert D_USER_ZONE_BY_ZONE_NAME(zn, zn2, mts)
    USER_ZONE(uid, zn) insert USER_ZONE(uid, zn2) USER_MODIFY_TS(uid, mts)

predicate D_ZONE_NAME_BY_ZONE_NAME object (key Text, property Text, property Text)
rewrite insert D_ZONE_NAME_BY_ZONE_NAME(zn, zn2, mts)
    ZONE_NAME(zid, zn) insert ZONE_NAME(zid, zn2) ZONE_MODIFY_TS(zid, mts)

predicate D_ZONE_TYPE_BY_NAME object (key Text, property Text)
rewrite D_ZONE_TYPE_BY_NAME(zn, type)
    ZONE_NAME(zid, zn) ZONE_TYPE(zid, type)

predicate D_ZONE_BY_NAME object (key Text)
rewrite delete D_ZONE_BY_NAME(zn)
    ZONE_NAME(zid, zn) delete ZONE_OBJ(zid)

predicate D_NUM_PASSWORD_BY_USER_NAME property (key Text, property Int)
rewrite D_NUM_PASSWORD_BY_USER_NAME(un, c)
    let c = count (USER_NAME(uid, un) USER_PASSWORD_OBJ(uid, pw))

predicate D_DATA_NAME property (key Text, property Text)
rewrite insert D_DATA_NAME(id, n)
    insert DATA_NAME(id, n)

predicate D_DATA_NAME_BY_ID_AND_ACCESS property (key Text, key Text, key Text, property Text)
rewrite D_DATA_NAME_BY_ID_AND_ACCESS(id, uz, un, n)
    DATA_NAME(id, n) D_TOKEN_ID("access_type", "own", tid) D_NON_GROUP_USER_ID(uz, un, uid) OBJT_ACCESS_OBJ(uid, id, tid)

predicate D_COLL_NAME property (key Text, property Text, property Text, property Text)
rewrite insert D_COLL_NAME(cid, cn, pn, mts)
    insert COLL_NAME(cid, cn) COLL_PARENT_COLL_NAME(cid, pn) COLL_MODIFY_TS(cid, mts)

predicate D_DATA_COLL_ID_TS property (key Text, property Text, property Text)
rewrite insert D_DATA_COLL_ID_TS(id, cid, mts)
    insert DATA_COLL_ID(id, cid) DATA_MODIFY_TS(id, mts)

predicate D_TOKEN object (key Text, property Text, property Text, property Text, property Text, property Text, property Text, property Text, property Text)
rewrite insert D_TOKEN( tid, tns, tn, value1, value2, value3, tcomment, cts, mts)
    insert TOKEN_OBJ(tid) TOKEN_NAMESPACE(tid, tns) TOKEN_NAME(tid, tn) TOKEN_VALUE(tid, value) TOKEN_VALUE1(tid, value2) TOKEN_VALUE1(tid, value3) TOKEN_COMMENT(tid, tcomment) TOKEN_CREATE_TS(tid, cts) TOKEN_MODIFY_TS(tid, mts)

predicate D_TOKEN_BY_NAMESPACE_AND_NAME object (key Text, key Text)
rewrite delete D_TOKEN_BY_NAMESPACE_AND_NAME( tns, tn)
    TOKEN_NAMESPACE(tid, tns) TOKEN_NAME(tid, tn) delete TOKEN_OBJ(tid)

predicate D_SERVER_LOAD object (key Text, key Text, key Text, key Text, key Text, key Text, key Text, key Text, key Text, key Text)
rewrite insert D_SERVER_LOAD( hostname, rescname, cpuused, memused, swapused, runqload, diskspace, netinput, netoutput, createts)
    insert SERVER_LOAD( hostname, rescname, cpuused, memused, swapused, runqload, diskspace, netinput, netoutput, createts)

predicate D_SERVER_LOAD_BY_CREATE_TS object (key Text)
rewrite delete D_SERVER_LOAD_BY_CREATE_TS( createts)
    SERVER_LOAD( hostname, rescname, cpuused, memused, swapused, runqload, diskspace, netinput, netoutput, createts2) lt(createts2, createts) delete SERVER_LOAD( hostname, rescname, cpuused, memused, swapused, runqload, diskspace, netinput, netoutput, createts)

predicate D_SERVER_LOAD_DIGEST object (key Text, key Text, key Text)
rewrite insert D_SERVER_LOAD_DIGEST(rescname, loadfactor, createts)
    insert SERVER_LOAD_OBJ( rescname, loadfactor, createts)

predicate D_SERVER_LOAD_DIGEST_BY_CREATE_TS object (key Text)
rewrite delete D_SERVER_LOAD_DIGEST_BY_CREATE_TS( createts)
    SERVER_LOAD_DIGEST_OBJ( rescname, loadfactor, createts2) lt(createts2, createts) delete SERVER_LOAD_DIGEST_OBJ(rescname, loadfactor, createts)

predicate D_QUOTA_USAGE_BY_MODIFY_TS object (key Text)
rewrite delete D_QUOTA_USAGE_BY_MODIFY_TS( createts)
    QUOTA_USAGE_OBJ( uid, rid, createts2) lt(createts2, createts) delete QUOTA_USAGE_OBJ(uid, rid, createts)

predicate D_QUOTA_USAGE object (key Text)
rewrite insert D_QUOTA_USAGE(mts)
    DATA_RESC_NAME(rid, rn)
    D_USER_ID(zn, un, uid)
    let usage = sum dsize ( DATA_OWNER_NAME(id, un) DATA_OWNER_ZONE(id, zn) DATA_RESC_NAME(id, rn) DATA_SIZE(id, dsize) )
    insert QUOTA_USAGE_OBJ(uid, rid, mts) QUOTA_USAGE(uid, rid, mts, usage)

predicate D_QUOTA_BY_USER_ID_AND_RESC_ID object (key Text, key Text)
rewrite delete D_QUOTA_BY_USER_ID_AND_RESC_ID( uid, rid)
    delete QUOTA_OBJ( uid, rid)

predicate D_QUOTA object (key Text, key Text, property Text, property Text)
rewrite insert D_QUOTA(uid, rid, a, mts)
    insert QUOTA_OBJ(uid, rid) QUOTA_LIMIT(uid, rid, a) QUOTA_MODIFY_TS(uid, rid, mts)

predicate D_QUOTA_BY_USER_NAME_AND_RESC_NAME property (key Text, key Text, property Text, property Text, property Text, property Text)
rewrite D_QUOTA_BY_USER_NAME_AND_RESC_NAME(un, rn, uid, rid, a, o)
    order by o desc (distinct ( (D_USER_ID(un, zn, uid) | D_GROUP_ID(un, zn, gid) USER_GROUP_OBJ(gid, uid) | eq(rid, "0")) RESC_NAME(rid, rn) QUOTA_LIMIT(uid, rid, a) QUOTA_OVER(uid, rid, o) return uid rid a o))

predicate D_NUM_DATA_BY_RESC_RECURSIVE property (key Text, property Text)
rewrite D_NUM_DATA_BY_RESC_RECURSIVE(rn, c)
    concat(root, rn, ";%") concat(mid1, "%;", rn) concat(mid, mid1, ";%") concat(leaf, "%;", rn)
    let c = count distinct id (DATA_RESC_HIER(id, h) (like (h, root) | like (h, mid) | like (h, leaf)))

predicate D_DATA_BY_RESC_NOT_IN_CHILD property (key Text, key Text, property Text)
rewrite D_DATA_BY_RESC_NOT_IN_CHILD(rn, crn, c)
    concat(root, rn, ";%") concat(mid1, "%;", rn) concat(mid, mid1, ";%") concat(leaf, "%;", rn)
    concat(croot, crn, ";%") concat(cmid1, "%;", crn) concat(cmid, cmid1, ";%") concat(cleaf, "%;", crn)
    distinct (DATA_RESC_HIER(id, h) (like (h, root) | like (h, mid) | like (h, leaf)) ~(like (h, croot) | like (h, cmid) | like (h, cleaf)) return id)

predicate D_DATA_BY_RESC_LIST property (key Text, key Text, property Text)
rewrite D_DATA_BY_RESC_LIST(rids, rids2, id)
    distinct (DATA_RESC_ID(id, rid) in(rid, rids) ~ in(rid, rids2) return id)

predicate D_NEXT_ID object (property Text)
rewrite D_NEXT_ID(oid)
    nextid(oid)

predicate D_USER_TYPE_BY_NAME_AND_USER_TYPE_TOKEN object (key Text, key Text, property Text, property Text)
rewrite insert D_USER_TYPE_BY_NAME_AND_USER_TYPE_TOKEN(zn, un, typetoken, mts)
    D_TOKEN_ID("user_type", typetoken, acc) D_USER_ID(zn, un, uid) insert USER_TYPE(uid, acc) USER_MODIFY_TS(uid, mts)

predicate D_USER_ZONE_NAME_BY_ZONE_AND_NAME object (key Text, key Text, property Text, property Text)
rewrite insert D_USER_ZONE_NAME_BY_ZONE_AND_NAME(zn, un, zn2, mts)
    D_USER_ID(zn, un, uid) insert USER_ZONE_NAME(uid, zn2) USER_MODIFY_TS(uid, mts)

predicate D_USER_AUTH_BY_USER_ZONE_AND_NAME object (key Text, key Text, property Text, property Text)
rewrite insert D_USER_AUTH_BY_USER_ZONE_AND_NAME(zn, un, authname, cts)
    D_USER_ID(zn, un, uid) insert USER_AUTH_OBJ(uid, authname) USER_AUTH_CREATE_TS(uid, authname, cts)

predicate D_USER_AUTH_BY_USER_NAME object (key Text, key Text, property Text)
rewrite delete D_USER_AUTH_BY_USER_NAME(zn, un, authname)
    D_USER_ID(zn, un, uid) delete USER_AUTH_OBJ(uid, authname)

predicate D_USER_INFO_BY_ZONE_AND_NAME object (key Text, key Text, property Text, property Text)
rewrite insert D_USER_INFO_BY_ZONE_AND_NAME(zn, un, info, mts)
    D_USER_ID(zn, un, uid) insert USER_INFO(uid, info) USER_MODIFY_TS(uid, mts)

predicate D_USER_COMMENT_BY_ZONE_AND_NAME object (key Text, key Text, property Text, property Text)
rewrite insert D_USER_COMMENT_BY_ZONE_AND_NAME(zn, un, comment, mts)
    D_USER_ID(zn, un, uid) insert USER_COMMENT(uid, comment) USER_MODIFY_TS(uid, mts)

predicate D_RESC_ID_BY_ACCESS property (key Text, key Text, key Text, key Text, property Text)
rewrite D_RESC_ID_BY_ACCESS(rn, uz, un, acclevel, rid)
    RESC_NAME(rid, rn) D_NON_GROUP_USER_ID(uz, un, uid) USER_GROUP_OBJ(gid, uid) D_TOKEN_ID("access_type", acclevel, tid) OBJT_ACCESS_OBJ(gid, rid, acclevel2) le(tid, acclevel2)

predicate D_COLL_ID_BY_COLL_ID_AND_ACCESS property (key Text, key Text, key Text, key Text, property Text)
rewrite D_COLL_ID_BY_COLL_ID_AND_ACCESS(rn, uz, un, acclevel, rid)
    COLL_NAME(rid, rn) D_NON_GROUP_USER_ID(uz, un, uid) USER_GROUP_OBJ(gid, uid) D_TOKEN_ID("access_type", acclevel, tid) OBJT_ACCESS_OBJ(gid, rid, acclevel2) le(tid, acclevel2)

predicate D_COLL_ID_BY_OWN property (key Text, key Text, key Text, property Text)
rewrite D_COLL_ID_BY_OWN(rn, uz, un, cid)
    COLL_NAME(cid, rn) COLL_OWNER_ZONE(cid, uz) COLL_OWNER_NAME(cid, un)

predicate D_COLL_ID_BY_ACCESS property (key Text, key Text, key Text, key Text, property Text)
rewrite D_COLL_ID_BY_ACCESS(cid, uz, un, acclevel, cid2)
    COLL_OBJ(cid) D_NON_GROUP_USER_ID(uz, un, uid) USER_GROUP_OBJ(gid, uid) D_TOKEN_ID("access_type", acclevel, tid) OBJT_ACCESS_OBJ(gid, cid, acclevel2) le(tid, acclevel2) eq(cid2, cid)

predicate D_COLL_ID_AND_INHERITANCE_BY_ACCESS property (key Text, key Text, key Text, key Text, property Text, property Text)
rewrite D_COLL_ID_AND_INHERITANCE_BY_ACCESS(rn, uz, un, acclevel, rid, rinh)
    COLL_NAME(rid, rn) D_NON_GROUP_USER_ID(uz, un, uid) USER_GROUP_OBJ(gid, uid) D_TOKEN_ID("access_type", acclevel, tid) OBJT_ACCESS_OBJ(gid, rid, acclevel2) le(tid, acclevel2) COLL_INHERITANCE(rid, rinh)

predicate D_DATA_ID_BY_ACCESS property (key Text, key Text, key Text, key Text, key Text, property Text)
rewrite D_DATA_ID_BY_ACCESS(cn, dn, uz, un, acclevel, id)
    COLL_NAME(cid, cn) D_DATA_ID(cid, dn, id) D_NON_GROUP_USER_ID(uz, un, uid) USER_GROUP_OBJ(gid, uid) D_TOKEN_ID("access_type", acclevel, tid) OBJT_ACCESS_OBJ(gid, id, acclevel2) le(tid, acclevel2)

predicate D_DATA_ID_BY_OWN property (key Text, key Text, key Text, key Text, property Text)
rewrite D_DATA_ID_BY_OWN(cid, dn, uz, un, id)
    D_DATA_ID(cid, dn, id)  DATA_OWNER_ZONE(id, uz) DATA_OWNER_NAME(id, un)

predicate D_GROUP_ID_BY_USER property (key Text, key Text, property Text)
rewrite D_GROUP_ID_BY_USER(uid, gn, gid)
    USER_NAME(gid, gn) USER_TYPE(gid, "rodsgroup") USER_GROUP_OBJ(gid, uid)

predicate D_DATA_ID_BY_DATA_ID_AND_ACCESS property (key Text, key Text, key Text, key Text, property Text)
rewrite D_DATA_ID_BY_DATA_ID_AND_ACCESS(cid, uz, un, acclevel, cid2)
    DATA_OBJ(cid, rid) D_NON_GROUP_USER_ID(uz, un, uid) USER_GROUP_OBJ(gid, uid) D_TOKEN_ID("access_type", acclevel, tid) OBJT_ACCESS_OBJ(gid, cid, acclevel2) le(tid, acclevel2) eq(cid2, cid)

predicate D_GROUP_ADMIN_USER_ID property (key Text, key Text, property Text)
rewrite D_GROUP_ADMIN_USER_ID(uz, un, uid)
    D_USER_ID(zn, un, uid) USER_TYPE(uid, "groupadmin")

predicate D_GROUP_MEMBER_COUNT property (key Text, property Int)
rewrite D_GROUP_MEMBER_COUNT(gn, c)
    USER_NAME(gid, gn) USER_TYPE(gid, "rodsgroup") USER_GROUP_OBJ(gid, uid) ~eq(gid, uid)

predicate D_ACCESS_PERMISSION_USE_WILDCARD property(key Text, key Text, key Text, key Text, property Text)
rewrite D_ACCESS_PERMISSION_USE_WILDCARD(un, uz, cn, dn, permission)
    let permission = min m
        (let m = max acc group by id
            (D_NON_GROUP_USER_ID(un, uz, uid) D_DATA_ID(cn2, dn2, id) like (cn2, cn) like(dn2, dn) USER_GROUP_OBJ(gid, uid) OBJT_ACCESS_OBJ(gid, id, acc)))

predicate D_NUM_ACCESS_PERMISSION_USE_WILDCARD property(key Text, key Text, key Text, key Text, property Text)
rewrite D_NUM_ACCESS_PERMISSION_USE_WILDCARD(un, uz, cn, dn, permission)
    let permission = count
        (let m = max acc group by id
            (D_NON_GROUP_USER_ID(un, uz, uid) D_DATA_ID(cn2, dn2, id) like (cn2, cn) like(dn2, dn) USER_GROUP_OBJ(gid, uid) OBJT_ACCESS_OBJ(gid, id, acc)))

predicate D_DATA_PATH_BY_USER_ZONE_AND_NAME_AND_RESC_NAME object (key Text, key Text, key Text, key Text, key Text)
rewrite insert D_DATA_PATH_BY_USER_ZONE_AND_NAME_AND_RESC_NAME(uz, un, rn, old, new)
    DATA_OWNER_ZONE(id, uz) DATA_OWNER_NAME(id, un) DATA_RESC_NAME(id, rn) DATA_FILE_PATH(id, path) replace(path, old, new, pathnew) insert DATA_FILE_PATH(id, pathnew)

predicate D_DATA_PATH object (key Text, key Text, key Text, key Text, key Text)
rewrite insert D_DATA_PATH(rn, old, new)
    DATA_RESC_NAME(id, rn) DATA_FILE_PATH(id, path) replace(path, old, new, pathnew) insert DATA_FILE_PATH(id, pathnew)

predicate D_COLL_NAME_RECURSIVE property(key Text, key Text)
rewrite insert D_COLL_NAME_RECURSIVE (oldcn, newcn)
    concat(oldcn, "/%", pattern) COLL_PARENT_COLL_NAME(cid, pcn) (eq(pcn, oldcn) | like(pcn, pattern)) COLL_NAME(cid, cn)
    strlen(oldcn, oldl) strlen(cn, l) substr(oldcn, oldl, l, scn) concat(newcn, scn, newcn2) insert COLL_NAME(cid, newcn2)

predicate D_DATA_RESC_HIER_RECURSIVE property(key Text, key Text, property Text)
rewrite insert D_DATA_RESC_HIER_RECURSIVE (delim, oldcn, newcn)
    concat(oldcn, delim, pattern0) concat(pattern0, "%", pattern) DATA_RESC_HIER(cid, pcn) (eq(pcn, oldcn) | like(pcn, pattern))
    strlen(oldcn, oldl) strlen(cn, l) substr(oldcn, oldl, l, scn) concat(newcn, scn, newcn2) insert DATA_RESC_HIER(cid, newcn2)

predicate D_DATA_RESC_HIER property(key Text, key Text, property Text)
rewrite insert D_DATA_RESC_HIER (delim, oldcn, newcn)
    concat("(^|(.+", delim, pattern0) concat(pattern0, "))", pattern1) concat(pattern1, oldcn, pattern2) concat(pattern2, "($|(", pattern3) concat(pattern3, delim, pattern4) concat(pattern4, ".+))", pattern)
    concat("\\1", newcn, replace0) concat(replace0, "\\3", replace)
    DATA_RESC_HIER(cid, pcn) regex_replace(pcn, pattern, replace, newcn2) insert DATA_RESC_HIER(cid, newcn2)

predicate D_COLL_PARENT_COLL_NAME_RECURSIVE property(key Text, key Text)
rewrite insert D_COLL_PARENT_COLL_NAME_RECURSIVE (oldscn, newscn)
    concat(oldcn, "/%", pattern) COLL_PARENT_COLL_NAME(cid, pcn) (eq(pcn, oldcn) | like(pcn, pattern))
    strlen(oldcn, oldl) strlen(pcn, l) substr(oldcn, oldl, l, scn) concat(newcn, scn, newcn2) insert COLL_PARENT_COLL_NAME(cid, newcn2)
